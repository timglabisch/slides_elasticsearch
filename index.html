<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>slides. elasticsearch.</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/serif.css" id="theme">
        <link rel="stylesheet" href="elasticsearch.css">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
            <script src="lib/js/html5shiv.js"></script>
		<![endif]-->


        <!-- <script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script> -->
        <script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/jquery.js"></script>

        <script type="text/javascript">

            jQuery.fn.identify = function(prefix) {
                var i = 0;
                return this.each(function() {
                    if($(this).attr('id')) return;
                    do {
                        i++;
                        var id = prefix + '_' + i;
                    } while($('#' + id).length > 0);
                    $(this).attr('id', id);
                });
            };

            $(document).ready(function(){

                ace.config.set("workerPath", "js/ace");

                // result editor
                document.ajaxresult = ace.edit('ajaxresultLayer');
                document.ajaxresult.setTheme("ace/theme/xcode");
                document.ajaxresult.getSession().setMode("ace/mode/json")
                document.ajaxresult.getSession().setUseWorker(false);


                $('.reveal').on('click', function() {
                    document.ajaxresult.setValue('');
                    $('#ajaxresultLayer').hide();
                });

                $('.elasticsearch.demo').each(function(){
                    $(this).identify('eldemo');

                    var editor = ace.edit($(this).attr('id'));
                    ace.config.set("workerPath", "js/ace");
                    editor.setTheme("ace/theme/xcode");
                    editor.getSession().setMode("ace/mode/json")
                    editor.getSession().setUseWorker(false);
                    editor.setValue(editor.getValue().trim())

                    var btn = $('<button>!%$" it</button>');
                    btn.on('click', function() {

                        $.ajax({
                            url: 'http://127.0.0.1:9200/'+ $(this.pre).parent().find('.url').val() +'?pretty=true',
                            type: $(this.pre).parent().find('.method').val().toUpperCase(),
                            dataType: 'json',
                            success: function(data) {
                                $('#ajaxresultLayer').show();
                                $('#ajaxresultLayer').css('border', 'none');

                                document.ajaxresult.setValue(JSON.stringify(data, null, '    '));
                            },
                            error: function(data) {
                                $('#ajaxresultLayer').show();
                                $('#ajaxresultLayer').css('border', '5px solid red');

                                if(typeof(data.responseText) != "undefined") {
                                    try {
                                        data.responseText = JSON.parse(data.responseText)
                                    } catch(e) {

                                    }

                                }

                                document.ajaxresult.setValue(JSON.stringify(data, null, '    '));
                            },
                            data: this.editor.getValue()
                        })


                    }.bind({editor: editor, pre: this}))

                    $(this).parent().prepend('<p>CURL -X <input type="text" class="method" value="'+ $(this).attr('data-method').toUpperCase() +'"/> .../ <input type="text" class="url" value="'+$(this).attr('data-url') + '"/></p>');

                    $(this).parent().append(btn);

                });
            });
        </script>


    </head>

	<body>

        <a target="_blank" href="https://github.com/timglabisch/slides_elasticsearch" style="z-index:9; position: absolute; top: 0; right: 0;">
            <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub">
        </a>

        <div id="ajaxresultLayer" style="display:none; position:absolute; background-color:rgb(116, 183, 63); margin-left:10%; margin-top:10%; width:80%; height:80%; z-index:2">

        </div>

		<div class="reveal">



			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>

                    <img src="images/bonsai.png" class="left" style="width:11%;display:block"/>

                    <div class="right" style="width:79%">
                        <h1>elasticsearch.</h1>

                    </div>
                    <div class="clear"></div>

                    <p>
                        flexible and powerful open source, distributed real-time<br/>
                        search and analytics engine for the cloud
                    </p>
					<small>
						by <a href="mailto:phpug_elasticsearch@tim.ainfach.de">@timglabisch</a>
					</small>
				</section>

				<section>
                    <h3>A Whole New Code Search. <small>@GitHub</small></h3>
					<img src="images/github_team.gif" style="width:80%"/>
                    <small>
                            <a target="_blank" href="https://github.com/blog/1449-cheers-sl-inte-prost-kampai-yung-sing-salud">github.com/blog/1449-cheers-sl-inte-prost-kampai-yung-sing-salud</a><br/>
                            <a target="_blank" href="https://github.com/blog/1381-a-whole-new-code-search">github.com/blog/1381-a-whole-new-code-search</a><br/>
                            <a target="_blank" href="https://github.com/search">github.com/search</a>
                    </small>
				</section>

                <section>
                    <a target="_blank" href="https://github.com/search?q=42&type=Repositories&ref=searchresults">
                        <img src="images/github_search_42.jpeg" style="width:100%" />
                    </a>

                    <aside class="notes">
                        Suchwort 42 - nicht nach der Antwort suchen :)<br/>
                        <br/>

                        Facetten - Aggregatoren<br/>
                        Facetten - Relatione Datenbank!?<br/>
                        Facetten brauchen RAM!<br/>
                        <br/>

                        Highlighting von Textstücken
                        <br/>

                        Advanced Search

                    </aside>

                </section>

                <section>
                    <strong>Real time data</strong>, Real time analytics, Distributed, High availability, Multi-tenancy, Full text search
                    Document oriented, Conflict management, <strike>Schema free</strike>, <strong>RESTful API</strong>, Per-operation persistence,
                    Apache 2 Open Source License, Build on top of <strong>Apache Lucene ™</strong>
                </section>

                <section>
                    <h2>lots of api's...</h2>
                    <small>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/search/">Search</a></strong> >
                        Query, Highlighting, Suggest, Facets, Min Score, Scroll, Explain, Version, ...
                        <br/>
                        <br/>

                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Indices</a></strong> >
                        Aliases, Analyze, Create Index, Delete Index, Open/Close Index, Get Settings, Get Mapping, Put Mapping, Delete Mapping,
                        Refresh, Optimize, Flush, Snapshot, Update Settings, Templates, Warmers, Stats, Status, Segments, Clear Cache, Indices Exists, Types Exists, ...
                        <br/>
                        <br/>

                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Cluser</a></strong> >
                        Health, State, Update Settings, Nodes Info, Nodes Stats, Nodes Shutdown, Nodes Hot Threads, Cluster reroute
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/query-dsl/">Complex Queries</a></strong> >
                        match, multi_match, bool, boosting, ids, custom_score, custom_boost_factor, constant_score, dis_max,
                        field, filtered, flt, flt_field, fuzzy, has_child, has_parent, match_all, mlt, mlt_field, prefix,
                        query_string, range, span_first, span_near, span_not, span_or, span_term, term, terms, top_children, wildcard,
                        nested, custom_filters_score, indices, text, geo_shape, and, bool, exists, ids, limit, type, geo_bbox, geo_distance, geo_distance_range,
                        geo_polygon, geo_shape, has_child, has_parent, match_all, missing, not, numeric_range, or, prefix, query, range, script, term
                        terms, nested
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Routings</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Mappings</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Modules</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">River</a></strong> > ...
                        <br/>
                        <br/>
                        ...
                    </small>
                </section>

                <section>
                    <h1>elasticsearch</h1>
                    <h2>in Action...</h2>
                </section>

                <section>
                    <h2>install</h2>
                    <p>
                        <strong>1.</strong> <a target="_blank" href="http://www.elasticsearch.org/download/">Download</a> and unzip the latest Elasticsearch distribution.<br/>
                        <br/>
                        <strong>2.</strong> Run bin/elasticsearch -f on Unix.
                    </p>
                </section>

                <section>
                    <h2>bin/elasticsearch -f</h2>
                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/bootstrap/ElasticSearchF.java">
                        <img src="images/source_bootstrapF.png" style="width:100%"/>
                    </a>

                </section>


                <section>

                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/node/internal/InternalNode.java#L136">
                        <img src="images/source_bootstrap_modules.png" style="width:100%"/>
                    </a>

                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/node/internal/InternalNode.java#L136">
                        org/elasticsearch/node/internal/InternalNode.java#L136
                    </a>

                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch">
{
    "user" : "timglabisch",
    "message" : "#elasticsearch is #awesome"
}
                    </pre>

                </section>

                <section>
                    <a href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57">
                        <img src="images/source_registerHandler.png" style="width:100%;"/>
                    </a>

                    <small>
                        <a href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57">
                            src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57
                        </a>
                    </small>
                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="get" data-url="twitter/timglabisch/_search">

                    </pre>

                </section>


                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "message" : "timglabisch"
        }
    }
}
                    </pre>

                </section>


                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "user" : "timglabisch",
            "message" : "#elasticsearch"
        }
    }
}
                    </pre>

                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "message" : "#elasticsearch"
        }
    }
}
                    </pre>

                </section>


                <section>

                    <h2>be aware</h2>
                    <p>
                        - term queries use OR by default!
                    </p>
                    <p>
                        - know the tokenizer, there is no <strong>#</strong>elasticsearch token!
                    </p>

                </section>

                <section>

                    <pre class="longtxt elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    term: {"user" : "timglabisch" }
                }
            ]
        }
    }
}
                    </pre>

                </section>


                <section>

                    <pre class="longtxt elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    bool: {
                        "must" : {
                            term: {"user" : "timglabisch" }
                        }
                    }
                }
            ]
        }
    }
}
                    </pre>

                </section>


                <section>

                    <p>- <strong>json</strong> is awesome to <strong>build queries</strong>.</p>
                    <p>- <strong>easy</strong> to write <strong>complex queries</strong></p>
                    <p>
                        - <strong>mix</strong> different query types
                        <small>
                        match, multi_match, <strong>bool</strong>, boosting, ids, custom_score,
                        custom_boost_factor, constant_score, dis_max, field, filtered, flt,flt_field,
                        fuzzy, has_child, has_parent, match_all, mlt, mlt_field, prefix, query_string,
                        range, span_first, span_near, span_not, span_or, span_term, <strong>term</strong>, terms, top_children
                        wildcard, nested, custom_filters_score, indices, text, geo_shape
                        <br/>
                        <a href="http://www.elasticsearch.org/guide/reference/query-dsl/" target="_blank">look at the manual</a>
                        </small>
                    </p>

                </section>


                <section>

                    <h2>
                        <a href="http://www.elasticsearch.org/guide/reference/api/search/facets/" target="_blank">
                            facets
                        </a>
                    </h2>
                    <a href="https://github.com/search?q=zend_&ref=simplesearch&type=Code" target="_blank">
                        <img src="images/github_facets.png" style="width:100%"/>
                    </a>


                </section>

                <section>
                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        }
    }
}
                    </pre>
                </section>

                <section>
                    <h4>multiple facets</h4>
                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        },
        "i_am_just_another_identifier": {
            "terms": { "field": "user" }
        }
    }
}
                    </pre>
                </section>

                <section>
                    <h3>different search phases.</h3>
                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128">
                        <img src="images/source_different_search_types.png" style="width:100%"/>
                    </a>

                    <small>
                        <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128">
                            src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128
                        </a>
                        <br/>
                        <br/>
                        the breakpoint is awesome to debug the generated lucene query.
                    </small>

                </section>

                <section>
                    <h3>combine query and facets.</h3>
                    <pre class="elasticsearch demo longtxt" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    term: {"user" : "timglabisch" }
                }
            ]
        }
    },
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        },
        "i_am_just_another_identifier": {
            "terms": { "field": "user" }
        }
    }
}
                    </pre>
                </section>

                <section>
                    <img src="images/facets_overview_hauptruppe.png" style="width:100%"/>
                </section>


                <section>
                    <img src="images/facets_overview_filterspng.png" style="width:100%"/>
                </section>

                <section>
                    <h2>Filters</h2>
                    <p>
                        Teilabfragen können unabhängig <a target="_blank" href="http://www.elasticsearch.org/guide/reference/query-dsl/">gefiltert</a> werden.
                    </p>
                </section>

                <section>
                    <pre class="elasticsearch demo longtxt" data-method="post" data-url="twitter/timglabisch/_search">
{
   "size":16,
   "facets":{
      "provider":{
         "terms":{
            "field":"provider",
            "size":35
         },
         "facet_filter":{
            "bool":{
               "must":[
                  {
                     "term":{
                        "level1":"Motor"
                     }
                  },
                  {
                     "term":{
                        "cars":"vw"
                     }
                  }
               ]
            }
         }
      },
      "cars":{
         "terms":{
            "field":"cars",
            "size":35
         },
         "facet_filter":{
            "bool":{
               "must":[
                  {
                     "term":{
                        "level1":"Motor"
                     }
                  },
                  {
                     "term":{
                        "provider":"Top-Angebot"
                     }
                  }
               ]
            }
         }
      },
      // ....
   },
   "query":{
      // jep we have a empty query ...
   },
   "filter":{
      "bool":{
         "must":[
            {
               "term":{
                  "level1":"Motor"
               }
            },
            {
               "term":{
                  "provider":"Top-Angebot"
               }
            },
            {
               "term":{
                  "cars":"vw"
               }
            }
         ]
      }
   }
}
                    </pre>
                </section>

                <section>
                    <p>
                        filters are awesome flexible, cacheable and reduce the number of requests.
                    </p>
                </section>

                <section>
                    <h1>Gui's</h1>
                    <p>
                        <a href="https://github.com/lukas-vlcek/bigdesk" target="_blank">gitdesk</a><br/>
                        <a href="https://github.com/mobz/elasticsearch-head" target="_blank">elasticsearch-head</a>
                    </p>
                </section>


                <section>
                    <iframe src="gui/bigdesk/index.html" style="width:100%;height:100%;border:1px solid black"></iframe>
                </section>


                <section>
                    <iframe src="gui/elasticsearch_head/index.html" style="width:100%;height:100%;border:1px solid black"></iframe>
                </section>

                <section>
                    <a href="http://mobz.github.com/elasticsearch-head/" target="_blank">
                        <img src="images/clusterOverview.png" style="width:100%;border:1px solid black"/>
                    </a>
                </section>


                <section>
                    <h1>Shards</h1>
                </section>

                <section>
                    <img src="images/2shards.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/2shards_one_query.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/two_shards_two_servers.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/replic_shards.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/shards_replicas.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/shards_balancing.png" style="width:100%"/>
                </section>

                <section>
                    <h1><a href="http://www.elasticsearch.org/guide/reference/api/search/" target="_blank">Routing</a></h1>
                </section>

                <section>
                    <img src="images/routing_no_routing.png" style="width:100%"/>
                </section>

                <section>
                    <img src="images/routing_routing.png" style="width:100%"/>
                </section>

                <section>
                    <h3>Routing By</h3>
                    <p>
                        - <a href="http://www.elasticsearch.org/guide/reference/mapping/routing-field/" target="_blank">id (default)</a><br/>
                        - <a href="http://www.elasticsearch.org/guide/reference/api/search/" target="_blank">parameter</a> ( /twitter/tweet?routing=timglabisch )<br/>
                        - <a href="http://www.elasticsearch.org/guide/reference/mapping/routing-field/" target="_blank">custom field / path</a>
                    </p>
                </section>

                <section>
                    <h1><a href="http://www.elasticsearch.org/guide/reference/mapping/">Mappings</a></h1>
                </section>




			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
