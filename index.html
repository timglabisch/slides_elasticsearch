<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>slides. elasticsearch.</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/serif.css" id="theme">
        <link rel="stylesheet" href="elasticsearch.css">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:300' rel='stylesheet' type='text/css'>

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
            <script src="lib/js/html5shiv.js"></script>
		<![endif]-->


        <!-- <script src="http://d1n0x3qji82z53.cloudfront.net/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script> -->
        <script src="js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/jquery.js"></script>

        <script type="text/javascript">

            jQuery.fn.identify = function(prefix) {
                var i = 0;
                return this.each(function() {
                    if($(this).attr('id')) return;
                    do {
                        i++;
                        var id = prefix + '_' + i;
                    } while($('#' + id).length > 0);
                    $(this).attr('id', id);
                });
            };

            $(document).ready(function(){

                ace.config.set("workerPath", "js/ace");

                // result editor
                document.ajaxresult = ace.edit('ajaxresultLayer');
                document.ajaxresult.setTheme("ace/theme/xcode");
                document.ajaxresult.getSession().setMode("ace/mode/json")
                document.ajaxresult.getSession().setUseWorker(false);


                $('.reveal').on('click', function() {
                    document.ajaxresult.setValue('');
                    $('#ajaxresultLayer').hide();
                });

                $('.elasticsearch.demo').each(function(){
                    $(this).identify('eldemo');

                    var editor = ace.edit($(this).attr('id'));
                    ace.config.set("workerPath", "js/ace");
                    editor.setTheme("ace/theme/xcode");
                    editor.getSession().setMode("ace/mode/json")
                    editor.getSession().setUseWorker(false);
                    editor.setValue(editor.getValue().trim())

                    var btn = $('<button>!%$" it</button>');
                    btn.on('click', function() {

                        var url = $(this.pre).parent().find('.url').val();

                        $.ajax({
                            url: 'http://127.0.0.1:9200/'+ url +  ( url && url.indexOf('?') > 0 ? '&' : '?' ) + 'pretty=true',
                            type: $(this.pre).parent().find('.method').val().toUpperCase(),
                            dataType: 'json',
                            success: function(data) {
                                $('#ajaxresultLayer').show();
                                $('#ajaxresultLayer').css('border', 'none');

                                document.ajaxresult.setValue(JSON.stringify(data, null, '    '));
                            },
                            error: function(data) {
                                $('#ajaxresultLayer').show();
                                $('#ajaxresultLayer').css('border', '5px solid red');

                                if(typeof(data.responseText) != "undefined") {
                                    try {
                                        data.responseText = JSON.parse(data.responseText)
                                    } catch(e) {

                                    }

                                }

                                document.ajaxresult.setValue(JSON.stringify(data, null, '    '));
                            },
                            data: this.editor.getValue()
                        })


                    }.bind({editor: editor, pre: this}))

                    $(this).parent().prepend('<p>CURL -X <input type="text" class="method" value="'+ $(this).attr('data-method').toUpperCase() +'"/> .../ <input type="text" class="url" value="'+$(this).attr('data-url') + '"/></p>');

                    $(this).parent().append(btn);

                });
            });
        </script>


    </head>

	<body>


        <div id="ajaxresultLayer" style="display:none; position:absolute; background-color:rgb(116, 183, 63); margin-left:10%; top:5%; width:80%; height:80%; z-index:2">

        </div>

        <a target="_blank" href="https://github.com/timglabisch/slides_elasticsearch" style="z-index:9; position: absolute; top: 0; right: 0;">
            <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub">
        </a>

		<div class="reveal">



			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>

                    <img src="images/bonsai.png" class="left" style="width:11%;display:block"/>

                    <div class="right" style="width:79%">
                        <h1>elasticsearch.</h1>
                    </div>
                    <div class="clear"></div>

                    <p>
                        flexible and powerful open source, distributed real-time<br/>
                        search and analytics engine for the cloud
                    </p>
					<small>
						by <a href="mailto:phpug_elasticsearch@tim.ainfach.de">@timglabisch</a>
					</small>


                    <aside class="notes">
                        <ul>
                            <li>Danke fürs kommen.</li>
                            <li>Ich bin <strong>Tim Glabisch</strong>, arbeite für <strong>AnyMotion Graphics</strong>.</li>
                            <li>
                                Hab schon mehrfach festgestellt, dass <strong>Suchen</strong> mit einer <strong>Relationalen Datenbank keinen Spass</strong> machen.
                                <ul>
                                    <li>Performance</li>
                                    <li>viel Aufwand</li>
                                    <li>Features fehlen - Volltextsuchen, Facetten, u.s.w.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>fork</strong> me on github!
                            </li>
                            <li>
                                fast alles <strong>paktische Beispiele</strong>!
                            </li>
                        </ul>
                    </aside>
				</section>

                <!--
				<section>
                    <h3>A Whole New Code Search. <small>@GitHub</small></h3>
					<img src="images/github_team.gif" style="width:80%"/>
                    <small>
                            <a target="_blank" href="https://github.com/blog/1449-cheers-sl-inte-prost-kampai-yung-sing-salud">github.com/blog/1449-cheers-sl-inte-prost-kampai-yung-sing-salud</a><br/>
                            <a target="_blank" href="https://github.com/blog/1381-a-whole-new-code-search">github.com/blog/1381-a-whole-new-code-search</a><br/>
                            <a target="_blank" href="https://github.com/search">github.com/search</a>
                    </small>

                    <aside class="notes">
                        <ul>
                            <li>ich hasse dieses Bild :)</li>
                            <li>diese Bilder entstehen bei <strong>neuen features</strong> bei Github.</li>
                            <li><strong>Github</strong> nutzt seit neuem Elasticsearch für die <strong>Code Suche</strong> - auch Foursquare</li>
                            <li>ich habe <strong>quasi alles verlinkt</strong>!</li>
                        </ul>
                    </aside>
				</section>
				-->

                <section>
                    <a target="_blank" href="https://github.com/search?q=42&type=Repositories&ref=searchresults">
                        <img src="images/github_search_42.jpeg" style="width:100%" />
                    </a>

                    <aside class="notes">
                        <ul>
                            <li>Beispiel einer Suchmaske</li>
                            <li>Suchwort 42 - nicht nach der Antwort suchen :)</li>
                            <li>Facetten - Aggregatoren</li>
                            <li>Facetten - Relatione Datenbank!?</li>
                            <li>Facetten brauchen RAM!</li>
                            <li>Highlighting von Textstücken</li>
                            <li>Advanced Search</li>
                        </ul>
                    </aside>

                </section>

                <section>
                    <strong>Real time data</strong>, Real time analytics, Distributed, High availability, Multi-tenancy, Full text search
                    Document oriented, Conflict management, <strike>Schema free</strike>, <strong>RESTful API</strong>, Per-operation persistence,
                    Apache 2 Open Source License, Build on top of <strong>Apache Lucene ™</strong>

                    <aside class="notes">
                        <ul>
                            <li>so beschreibt sich Elasticsearch</li>
                            <li>fast alles für <strong>heute unwichtig!</strong></li>
                            <li>Realtime kann nicht jeder Suchserver - Realtime bedeutet wenige Sekunden nach dem Indizieren </li>
                            <li>Elasticsearch nutzt Rest</li>

                        </ul>
                    </aside>

                </section>

                <section>
                    <h2>lots of api's...</h2>
                    <small>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/search/">Search</a></strong> >
                        Query, Highlighting, Suggest, Facets, Min Score, Scroll, Explain, Version, ...
                        <br/>
                        <br/>

                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Indices</a></strong> >
                        Aliases, Analyze, Create Index, Delete Index, Open/Close Index, Get Settings, Get Mapping, Put Mapping, Delete Mapping,
                        Refresh, Optimize, Flush, Snapshot, Update Settings, Templates, Warmers, Stats, Status, Segments, Clear Cache, Indices Exists, Types Exists, ...
                        <br/>
                        <br/>

                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Cluser</a></strong> >
                        Health, State, Update Settings, Nodes Info, Nodes Stats, Nodes Shutdown, Nodes Hot Threads, Cluster reroute
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/query-dsl/">Complex Queries</a></strong> >
                        match, multi_match, bool, boosting, ids, custom_score, custom_boost_factor, constant_score, dis_max,
                        field, filtered, flt, flt_field, fuzzy, has_child, has_parent, match_all, mlt, mlt_field, prefix,
                        query_string, range, span_first, span_near, span_not, span_or, span_term, term, terms, top_children, wildcard,
                        nested, custom_filters_score, indices, text, geo_shape, and, bool, exists, ids, limit, type, geo_bbox, geo_distance, geo_distance_range,
                        geo_polygon, geo_shape, has_child, has_parent, match_all, missing, not, numeric_range, or, prefix, query, range, script, term
                        terms, nested
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Routings</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Mappings</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">Modules</a></strong> > ...
                        <br/>
                        <br/>
                        <strong><a href="http://www.elasticsearch.org/guide/reference/api/">River</a></strong> > ...
                        <br/>
                        <br/>
                        ...

                        <aside class="notes">
                            <ul>
                                <li>bitte <strong>nicht lesen</strong>!</li>
                                <li>es kann viel. wirklich.</li>
                                <li>Manual ist vollständig - aber wirklich ein Handbuch.</li>
                                <li>Buch - Jede Seite neue Funktionen.</li>
                                <li>Funktionen sind kombinierbar und wirklich sinnvoll!</li>
                            </ul>
                        </aside>
                    </small>
                </section>

                <section>
                    <h1>elasticsearch</h1>
                    <h2>in Action...</h2>

                    <aside class="notes">
                        <ul>
                            <li>wir schauen uns das an, was für eure <strong>erste Suchanwendung wichtig</strong>.</li>
                            <li>mein Ziel - <strong>ihr geht nach hause und könnt eine 0-8-15 Suchmaske bauen</strong>.</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h2>install</h2>
                    <p>
                        <strong>1.</strong> <a target="_blank" href="http://www.elasticsearch.org/download/">Download</a> and unzip the latest Elasticsearch distribution.<br/>
                        <br/>
                        <strong>2.</strong> Run bin/elasticsearch -f on Unix.
                    </p>
                    <aside class="notes">
                        <ul>
                            <li>installation ist einfach</li>
                            <li>runterlasen</li>
                            <li>installer für init Skripte runderladen - ausführen</li>
                            <li>defaults sind alle brauchbar!</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h2>bin/elasticsearch -f</h2>
                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/bootstrap/ElasticSearchF.java">
                        <img src="images/source_bootstrapF.png" style="width:100%"/>
                    </a>
                    <aside class="notes">
                        <ul>
                            <li>front modus</li>
                            <li>super zum debuggen</li>
                            <li>strg + C zum beenden</li>
                            <li>als Service einfach ohne -f</li>
                            <li>ihr könnt auch mehrere Instanzen starten</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/node/internal/InternalNode.java#L136">
                        <img src="images/source_bootstrap_modules.png" style="width:100%"/>
                    </a>

                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/node/internal/InternalNode.java#L136">
                        org/elasticsearch/node/internal/InternalNode.java#L136
                    </a>

                    <aside class="notes">
                        <ul>
                            <li>elasticsearch ist modular</li>
                            <li>code sieht sehr sauber aus</li>
                            <li>veschiedene module werden gestartet</li>
                            <li>nutzt netty und guice</li>
                            <li>plugin api vorhanden</li>
                            <li>discovery modul findet andere Instanzen - broadcast, ip liste, amazon, ...</li>
                            <li>Rest modul für alle Rest anfragen</li>
                            <li>Buld modul für größere Mengen von Daten, Udp auch möglich.</li>
                        </ul>
                    </aside>

                </section>

                <section>
                    <h2>say hello.</h2>
                    <pre class="elasticsearch demo" data-method="get" data-url="">

                    </pre>


                    <aside class="notes">
                        <ul>
                            <li>editor habe ich gabaut</li>
                            <li>oben die url und die http methode</li>
                            <li>unten der senden button</li>
                            <li>response öffnet sich asap</li>
                        </ul>
                    </aside>

                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch">
{
    "user" : "timglabisch",
    "message" : "#elasticsearch is #awesome",
    "tags" : ["elasticsearch", "awesome"]
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>einfaches hnzufügen von Daten</li>
                            <li>nur Json</li>
                            <li>daten werden als original gespeichert</li>
                            <li>daten werden indiziert - inverted index</li>
                        </ul>
                    </aside>

                </section>

                <section>
                    <a href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57">
                        <img src="images/source_registerHandler.png" style="width:100%;"/>
                    </a>

                    <small>
                        <a href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57">
                            src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java#L57
                        </a>
                    </small>

                    <aside class="notes">
                        <ul>
                            <li>Module registrieren in netty Handler</li>
                            <li>Diese können über die Url angesprochen werden</li>
                        </ul>
                    </aside>
                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="get" data-url="twitter/timglabisch/_search">

                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>einfache Suchanfrage</li>
                            <li>gibt alles zurück - size von 10</li>
                            <li>keine Bedingungen</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "message" : "timglabisch"
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Suche nach einem Term</li>
                            <li>Term entspricht einem Token!</li>
                            <li>Token muss nur in dem Text vorkommen, anders als bei MySql</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "user" : "timglabisch",
            "message" : "#elasticsearch"
        }
    }
}
                    </pre>


                    <aside class="notes">
                        <ul>
                            <li>Suche nach mehreren Terms</li>
                        </ul>
                    </aside>

                </section>

                <section>

                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "term": {
            "message" : "#elasticsearch"
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Was passiert nun?</li>
                            <li>ausführen!!</li>
                            <li>Warum gibt es kein Ergebnis?</li>
                            <li>Tokenizer und #</li>
                            <li>Warum gab es vorher ein Ergebnis? - nochmal zurück!!</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <h2>be aware</h2>
                    <p>
                        - term queries use OR by default!
                    </p>
                    <p>
                        - know the tokenizer, there is no <strong>#</strong>elasticsearch token!
                    </p>

                    <aside class="notes">
                        <ul>
                            <li>merkt euch die Slide</li>
                            <li>war mein erster "Fehler" mit elasticsearch</li>
                            <li>wie aber setzen wir es dann um?</li>
                        </ul>
                    </aside>

                </section>

                <section>

                    <pre class="longtxt elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    term: {"user" : "timglabisch" }
                }
            ]
        }
    }
}
                    </pre>
                    <aside class="notes">
                        <ul>
                            <li>bool query</li>
                            <li>mehrere Subqueries</li>
                            <li>must, must not, should</li>
                            <li>bei should kann man bei mehreren unterabfragen definieren wieviele mind zutreffen müssen</li>
                            <li>treffer bei should erhöhen das Ranking - boosting</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <pre class="longtxt elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    bool: {
                        "must" : {
                            term: {"user" : "timglabisch" }
                        }
                    }
                }
            ]
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>queries lassen sich beliebig schachteln</li>
                            <li>unterschiedliche query typen sind kombinierbar</li>
                            <li>wir haben 2 term queries und 2 bool queries</li>
                            <li>sehr komplexe Queries möglich</li>
                        </ul>
                    </aside>

                </section>


                <section>

                    <p>- <strong>json</strong> is awesome to <strong>build queries</strong>.</p>
                    <p>- <strong>easy</strong> to write <strong>complex queries</strong></p>
                    <p>
                        - <strong>mix</strong> different query types
                        <small>
                        match, multi_match, <strong>bool</strong>, boosting, ids, custom_score,
                        custom_boost_factor, constant_score, dis_max, field, filtered, flt,flt_field,
                        fuzzy, has_child, has_parent, match_all, mlt, mlt_field, prefix, query_string,
                        range, span_first, span_near, span_not, span_or, span_term, <strong>term</strong>, terms, top_children
                        wildcard, nested, custom_filters_score, indices, text, geo_shape
                        <br/>
                        <a href="http://www.elasticsearch.org/guide/reference/query-dsl/" target="_blank">look at the manual</a>
                        </small>
                    </p>


                    <aside class="notes">
                        <ul>
                            <li>sql strings bauen ist fehleranfällig</li>
                            <li>ich habe schon kuriose möglichkeiten gesehen wie sql zusammengebaut wird</li>
                            <li>ich habe schn projekte gesehen die daran gescheitert sind</li>
                            <li>json zu modifizieren ist eine gute möglichkeit</li>
                            <li>viele verschiedene Suchtypen</li>
                            <li>beispielsweise kurioseste formen auf einer karte für geosuchen...</li>
                            <li>alle lassen sich kombinieren</li>
                        </ul>
                    </aside>
                </section>


                <section>

                    <h2>
                        <a href="http://www.elasticsearch.org/guide/reference/api/search/facets/" target="_blank">
                            facets
                        </a>
                    </h2>
                    <a href="https://github.com/search?q=zend_&ref=simplesearch&type=Code" target="_blank">
                        <img src="images/github_facets.png" style="width:100%"/>
                    </a>

                    <aside class="notes">
                        <ul>
                            <li>Aggregationen</li>
                            <li>Performanceprobleme bei relationalen Datenbanken</li>
                            <li>können unterschiedliche filter beinhalen, z.b. eine programmiersprache</li>
                        </ul>
                    </aside>

                </section>

                <section>
                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Facetten haben einen identifier</li>
                            <li>Facetten haben eine beliebige Query, bzw. Filter</li>
                            <li>Facetten betreffen immer ein Feld</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h4>multiple facets</h4>
                    <pre class="elasticsearch demo" data-method="post" data-url="twitter/timglabisch/_search">
{
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        },
        "i_am_just_another_identifier": {
            "terms": { "field": "user" }
        }
    }
}

                        <aside class="notes">
                            <ul>
                                <li>Mehrere Facetten sind möglich</li>
                                <li>Facetten könnnen unterschiedliche Filter haben</li>
                                <li>Facetten findet man über den Identfier wieder</li>
                                <li>Facetten sind sehr performant</li>
                                <li>Facetten brauchen Ram</li>
                            </ul>
                        </aside>
                    </pre>
                </section>

                <section>
                    <h3>different search phases.</h3>
                    <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128">
                        <img src="images/source_different_search_types.png" style="width:100%"/>
                    </a>

                    <small>
                        <a target="_blank" href="https://github.com/elasticsearch/elasticsearch/blob/master/src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128">
                            src/main/java/org/elasticsearch/search/query/QueryPhase.java#L128
                        </a>
                        <br/>
                        <br/>
                        the breakpoint is awesome to debug the generated lucene query.
                    </small>

                    <aside class="notes">
                        <ul>
                            <li>verschiedene Suchphasen</li>
                            <li>werden unabhängig von der Query Phast und der Suggestion Phase ausgeführt</li>
                            <li>eine Anfrage kann eine Query sowie Facetten beinhalten</li>
                            <li>stelle ist gut zum debuggen</li>
                            <li>elasticsearch hat hier die Anfrage zu einer Lucene Anfrage umgebaut</li>
                        </ul>
                    </aside>

                </section>

                <section>
                    <h3>combine query and facets.</h3>
                    <pre class="elasticsearch demo longtxt" data-method="post" data-url="twitter/timglabisch/_search">
{
    "query" : {
        "bool": {
            "must": [
                {
                    term: {"message" : "elasticsearch" }
                },
                {
                    term: {"user" : "timglabisch" }
                }
            ]
        }
    },
    "facets" : {
        "i_am_just_an_identifier": {
            "terms": { "field": "message" }
        },
        "i_am_just_another_identifier": {
            "terms": { "field": "user" }
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Query kombiniert mit Facetten</li>
                            <li>Suchergebnis + Facetten Ergebnisse</li>
                            <li>Facetten nutzten die Query um sich selbst zu filtern</li>
                            <li>Query bezieht sich immer auf alles</li>
                        </ul>
                    </aside>
                </section>

                <!--
                <section>
                    <img src="images/facets_overview_hauptruppe.png" style="width:100%"/>

                    <aside class="notes">
                        <ul>
                            <li>Komplexere Facetten</li>
                            <li>Facetten der Hauptgruppe bezieht sich nicht auf die Filter der Facetten auf der rechten Seite</li>
                        </ul>
                    </aside>
                </section>
                -->


                <section>
                    <img src="images/facets_overview_filterspng.png" style="width:100%"/>

                    <aside class="notes">
                        <ul>
                            <li>zwei Beispiele</li>
                            <li>das Rote soll das Grüne nicht filtern</li>
                            <li>Facetten dürfen sich nicht selbst ausschließen</li>
                            <li>Oberkategorien sollen noch anzeigbar und anklickbar sein</li>
                            <li>Facetten müssen Filtermöglichkeiten beeinflussen können</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h2>Filters</h2>
                    <p>
                        Teilabfragen können unabhängig <a target="_blank" href="http://www.elasticsearch.org/guide/reference/query-dsl/">gefiltert</a> werden.
                    </p>

                    <aside class="notes">
                        <ul>
                            <li>Filter sind <strong>Subqueries</strong> die sich nur auf Teile der Abfrage beziehen - Facetten, Subqueries, ...</li>
                            <li>Filter sind performant</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <pre class="elasticsearch demo longtxt" data-method="post" data-url="twitter/timglabisch/_search">
{
   "size":16,
   "facets":{
      "provider":{
         "terms":{
            "field":"provider",
            "size":35
         },
         "facet_filter":{
            "bool":{
               "must":[
                  {
                     "term":{
                        "level1":"Motor"
                     }
                  },
                  {
                     "term":{
                        "cars":"vw"
                     }
                  }
               ]
            }
         }
      },
      "cars":{
         "terms":{
            "field":"cars",
            "size":35
         },
         "facet_filter":{
            "bool":{
               "must":[
                  {
                     "term":{
                        "level1":"Motor"
                     }
                  },
                  {
                     "term":{
                        "provider":"Top-Angebot"
                     }
                  }
               ]
            }
         }
      },
      // ....
   },
   "query":{
      // jep we have a empty query ...
   },
   "filter":{
      "bool":{
         "must":[
            {
               "term":{
                  "level1":"Motor"
               }
            },
            {
               "term":{
                  "provider":"Top-Angebot"
               }
            },
            {
               "term":{
                  "cars":"vw"
               }
            }
         ]
      }
   }
}
                    </pre>
                    <aside class="notes">
                        <ul>
                            <li>erst hauptfilter anschauen - beinhaltet: level1, provider, cars</li>
                            <li>facette provider - beinhaltet level1, cars</li>
                            <li>facette cars - beinhaltet level1, provider</li>
                            <li>query ist leer</li>
                            <li>Der Hauptfilter beinhaltet die Filter für die Suchabfrage</li>
                            <li>Queries beziehen sich immer auf alles</li>
                            <li>Filter sind performant</li>
                            <li>Filter sind sehr flexibel</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <p>
                        filters are awesome flexible, cacheable and reduce the number of requests.
                    </p>
                </section>

                <section>
                    <a href="http://mobz.github.com/elasticsearch-head/" target="_blank">
                        <img src="images/clusterOverview.png" style="width:100%;border:1px solid black"/>
                    </a>

                    <aside class="notes">
                        <ul>
                            <li>wenns mal mehr werden</li>
                            <li>Übersicht der indizes</li>
                            <li>Übersicht der rechner</li>
                            <li>Gesundheit des clusters</li>
                        </ul>
                    </aside>
                </section>


                <section>
                    <h1>Shards</h1>

                    <aside class="notes">
                        <ul>
                            <li>Datenblöcke welche verschoben werden können</li>
                            <li>Daten werden in Shards unterteilt</li>
                            <li>Anzahl der Shards müssen beim Erstellen des Indizes bekannt sein</li>
                            <li>Kleine Datenmenge = wenig Shards</li>
                            <li>Weniger Shards = bessere Performance</li>
                            <li>Weniger Shards = weniger mögl. Daten</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/2shards.png" style="width:100%"/>

                    <aside class="notes">
                        <ul>
                            <li>Daten könnten über 2 Server verteilt werden</li>
                            <li>Bei vielen Daten bessere Performance</li>
                            <li>Bei wenig Daten schlechtere Performance</li>
                            <li>Durch reverted Index geringe Datenmengen</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/2shards_one_query.png" style="width:100%"/>

                    <aside class="notes">
                        <ul>
                            <li>Eine Abfrage = Anfrage auf beide Shards</li>
                            <li>Optimiert durch Bloom Filter u.s.w.</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/two_shards_two_servers.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>Shards können auf 2 Servern liegen</li>
                            <li>Shards verschieben ist teuer</li>
                            <li>Steuerbar über API</li>
                            <li>Flexibel: Rack, Gruppen, ...</li>
                            <li>Default: 5</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/replic_shards.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>Replicas</li>
                            <li>Ausfallsicherheit</li>
                            <li>Performance</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/shards_replicas.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>Kombination Replica und Shards</li>
                            <li>Ausfallsicherheit + Performance</li>
                            <li>Default - Fall genug Server vorhanden</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/shards_balancing.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>Rot (Server C) fällt weg</li>
                            <li>Gelb (Server B, D) übernehmen einen Shard</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h1><a href="http://www.elasticsearch.org/guide/reference/api/search/" target="_blank">Routing</a></h1>
                    <aside class="notes">
                        <ul>
                            <li>Möglichkeit Performance zu verbessern</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/routing_no_routing.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>ohne Routing</li>
                            <li>alle Shards müssen angefragt werden</li>
                            <li>ergnisse aller Shards müssen aggregiert werden</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <img src="images/routing_routing.png" style="width:100%"/>
                    <aside class="notes">
                        <ul>
                            <li>ein Feld kann bestimmen auf welchem Shard es liegt</li>
                            <li>Anzahl der Shards stehen fest</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h3>Routing By</h3>
                    <p>
                        - <a href="http://www.elasticsearch.org/guide/reference/mapping/routing-field/" target="_blank">id (default)</a><br/>
                        - <a href="http://www.elasticsearch.org/guide/reference/api/search/" target="_blank">parameter</a> ( /twitter/tweet?routing=timglabisch )<br/>
                        - <a href="http://www.elasticsearch.org/guide/reference/mapping/routing-field/" target="_blank">custom field / path</a>
                    </p>

                    <aside class="notes">
                        <ul>
                            <li>Gut für die Performance</li>
                            <li>Möglichkeit für Kundenspzische Suchen, Kategorieabhängige, u.s.w.</li>
                            <li>Bei vielen Daten zu empfehlen!</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h1><a href="http://www.elasticsearch.org/guide/reference/mapping/">Mappings</a></h1>
                    <p>
                        Elasticseatch isn't schemaless.
                    </p>
                    <aside class="notes">
                        <ul>
                            <li>Schemaless steht auf der Startseite</li>
                            <li>Lüge!</li>
                            <li>Beweis folgt</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h4>Index an int</h4>
                    <pre class="elasticsearch demo" data-method="post" data-url="wayne/schemaless_proof">
{
    "some_value": 1
}
                    </pre>
                    <aside class="notes">
                        <ul>
                            <li>Als erstes ein Int anlegen</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h4>try to index a string to the same field ...</h4>
                    <pre class="elasticsearch demo" data-method="post" data-url="wayne/schemaless_proof">
{
    "some_value": "i am just a string"
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Versuch einen String in identisches Feld zu speichern - scheitert</li>
                            <li>Andersrum wäre es möglich!</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h2>
                        the first value for a key maps your types.
                    </h2>
                    <p>
                        sounds ugly but allows to start easy.
                    </p>
                    <aside class="notes">
                        <ul>
                            <li>Mapping wird beim ersten Insert eines neuen Feldes erraten</li>
                            <li>Bitte nicht Produktiv so machen.</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h4>add the mapping</h4>
                    <pre class="elasticsearch demo" data-method="put" data-url="wayne/schemaless_proof_2/_mapping">
{
    "schemaless_proof_2" : {
        "properties" : {
            "age" : {
                "type" : "integer"
            },
            "name" : {
                "type" : "string",
                "search_analyzer": "keyword",
                "index_analyzer" : "keyword"
            }
        }
    }
}
                    </pre>

                    <aside class="notes">
                        <ul>
                            <li>Mappings sind einfach</li>
                            <li>Erste Node - Type</li>
                            <li>Felder als Properties</li>
                            <li>Type für den Feldtypen</li>
                            <li>Weitere möglichkeiten wie nutzung von analyzer, tokenizer. - eigene Analyzer, ...</li>
                        </ul>
                    </aside>
                </section>


                <section>
                    <h4>get the mapping</h4>
                    <pre class="elasticsearch demo" data-method="get" data-url="wayne/schemaless_proof_2/_mapping">

                    </pre>
                    <aside class="notes">
                        <ul>
                            <li>Auslesen des Mappings - GET Request</li>
                            <li>Erratende Mppings lassen sich auch auslesen</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h3>Proof</h3>
                    <pre class="elasticsearch demo" data-method="post" data-url="wayne/schemaless_proof_2">
{
    "age": 4, "name" : 10
}
                    </pre>
                </section>

                <section>
                    <pre class="elasticsearch demo" data-method="post" data-url="wayne/schemaless_proof_2">
{
    "age": 22, "name" : "Tim Glabisch"
}
                    </pre>
                </section>

                <section>
                    <h1>remapping sucks</h1>
                    <aside class="notes">
                        <ul>
                            <li>Probleme welche man nicht Live haben will!</li>
                        </ul>
                    </aside>
                </section>


                <section>
                    <h1>tokenizer</h1>
                </section>

                <section>
                    <img src="images/tokenizer.gif" style="width:100%"/>
                    <small>
                        by <a href="http://mata.gia.rwth-aachen.de/Docs/JavaInsel/bilderklein/kleinStringTokenizer.gif">mata.gia.rwth-aachen.de</a>
                    </small>
                    <aside class="notes">
                        <ul>
                            <li>Tokenizer unterteilt Texte in Suchbare tokens</li>
                            <li>Man sucht immer nach Tokens - nicht nach Textblöcken (Vergleich Mysql Varchar Feld)</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <p><small>there are a bunch of <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/keyword-tokenizer/" target="_blank">tokenizers</a>:
                        Edge NGram, Keyword, Letter, Lowercase, NGram, Standard, Whitespace, Pattern, UAX URL Email, Path Hierarchy</small></p>
                    <pre class="elasticsearch demo" data-method="post" data-url="_analyze?tokenizer=keyword">
this is a text
                    </pre>
                    <aside class="notes">
                        <ul>
                            <li>bei marken namen: Coca Cola -> Coca und Cola oder "Coca Cola"</li>
                            <li>unterschiedlichste, E-Mails, Regex, ...</li>
                            <li>NGram Example vll. mal zeigen</li>
                            <li>NGram für Prefix Suche</li>
                        </ul>
                    </aside>
                </section>


                <section>
                    <p>
                        <small>there are a bunch of <a href="http://www.elasticsearch.org/guide/reference/index-modules/analysis/stemmer-tokenfilter/" target="_blank">tokenfilters</a>:
Standard, ASCII Folding, Length, Lowercase, NGram, Edge NGram, Porter Stem, Shingle, Stop, Word Delimiter, Stemmer, and 15 more...
                        </small>
                    </p>
                    <pre class="elasticsearch demo" data-method="post" data-url="_analyze?filters=lower">
Für die Zukunft sind
Computer mit weniger
als 1,5 Tonnen Gewicht vorstellbar.
                    </pre>
                    <small>
                        Popular Mechanics, US-Technik-Magazin, 1949
                    </small>
                    <aside class="notes">
                        <ul>
                            <li>filter wie Lowercase, Stopwörter u.s.w.</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <h1>there is so much more...</h1>
                </section>

                <section>
                    <h1>Gui's</h1>
                    <p>
                        <a href="https://github.com/lukas-vlcek/bigdesk" target="_blank">bigdesk</a><br/>
                        <a href="https://github.com/mobz/elasticsearch-head" target="_blank">elasticsearch-head</a>
                    </p>

                    <aside class="notes">
                        <ul>
                            <li>plain javascript / html</li>
                            <li>bigdesk - viele Statistiken, Monitoring, Replica, Überwachung Cluster</li>
                            <li>elasticsearch-head - Ajax Maske, Replica, Überwachung Cluster</li>
                        </ul>
                    </aside>
                </section>

                <section>
                    <iframe src="gui/bigdesk/index.html" style="width:100%;height:100%;border:1px solid black"></iframe>
                </section>

                <section>
                    <iframe src="gui/elasticsearch_head/index.html" style="width:100%;height:100%;border:1px solid black"></iframe>
                </section>

                <section>
                    <h1>questions?</h1>
                </section>

                <section>
                    <h1>thx.</h1>
                </section>



			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: 'linear', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
